// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Profile info
  name      String?
  gender    String   // 'M', 'F'
  birthDate DateTime?
  height    Int?     // in cm
  location  String?
  bio       String?
  photos    String?  // JSON string of photo URLs
  
  // New Preferences / Description
  lookingFor String? // Opis kaj išče
  interests  String? // JSON string or comma separated tags
  personalTraits String? // JSON string (What they are like)
  partnerTraits  String? // JSON string (What attracts them)

  // Smart Matching Fields
  tagsSelf       String? // Comma separated: "Mlad,Resen,Sportnik"
  tagsLookingFor String? // Comma separated: "Starejsa,Milf,Urejena"
  ageRangeMin    Int     @default(18)
  ageRangeMax    Int     @default(99)
  region         String? // e.g. "Osrednjeslovenska"
  
  // Physical Attributes
  isSmoker       Boolean  @default(false)
  hairColor      String?  // Črna, Rjava, Blond, Rdeča, Siva, Brez
  eyeColor       String?  // Rjave, Modre, Zelene, Sive, Mešane
  bodyType       String?  // Vitka, Povprečna, Atletska, Krepka, Par extra kg
  
  // Lifestyle & Status
  relationshipType String? // Resna zveza, Prijateljstvo, Pustolovščina, Odprto
  hasChildren    Boolean? // null = ni določeno
  wantsChildren  Boolean? // null = ni določeno
  education      String?  // Osnovna, Srednja, Višja, Visoka, Magisterij, Doktorat
  occupation     String?  // Prosto besedilo
  
  // Settings
  voiceCallAllowed Boolean @default(false)
  browseAnonymously Boolean @default(false) // Women can browse without men knowing
  
  // Visibility Settings - What others can see
  showAge        Boolean @default(true)
  showHeight     Boolean @default(true)
  showOccupation Boolean @default(true)
  showEducation  Boolean @default(true)
  showChildren   Boolean @default(false)  // Sensitive - off by default

  // Verification
  isVerified         Boolean @default(false)
  verificationStatus String  @default("NONE") // NONE, PENDING, APPROVED, REJECTED

  // Premium
  isPremium Boolean @default(false)

  // Relations
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  
  filter           Filter?
  ads              Ad[]
  
  // Interest System
  sentInterests     Interest[] @relation("SentInterests")
  receivedInterests Interest[] @relation("ReceivedInterests")

  // Chat Rooms
  roomMessages      RoomMessage[]
}

model Filter {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])
  
  // Age criteria
  minAge    Int?
  maxAge    Int?
  
  // Physical criteria
  minHeight Int?
  maxHeight Int?
  
  // Lifestyle
  mustNotSmoke Boolean @default(false)
  
  // Location
  preferredRegion String?  // e.g. "Osrednjeslovenska"
  
  // Quality filters
  mustHavePhoto    Boolean @default(false)
  mustBeVerified   Boolean @default(false)
  
  // Physical preferences (can be null = "Vseeno")
  preferredHairColor  String?  // Črna, Rjava, Blond, etc. or null
  preferredEyeColor   String?  
  preferredBodyType   String?  
  
  // Lifestyle preferences
  preferredRelationType String? // Resna zveza, Prijateljstvo, etc.
  mustNotHaveChildren Boolean @default(false)
  mustWantChildren    Boolean @default(false)
  preferredEducation  String? // Minimum education level
}

model Message {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())
  
  senderId    String
  sender      User   @relation("SentMessages", fields: [senderId], references: [id])
  
  receiverId  String
  receiver    User   @relation("ReceivedMessages", fields: [receiverId], references: [id])

  folder      String  @default("PRIMARY") // PRIMARY or OTHERS
  isRead      Boolean @default(false)
}

model Ad {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  title     String
  content   String
  location  String?
  eventDate DateTime?
  category  String   @default("GENERAL") // GENERAL, DATE, ACTIVITY, TRIP
  createdAt DateTime @default(now())
  isActive  Boolean  @default(true)
  
  // Visibility Settings for this Ad (Optional override of global filter)
  // For now, we rely on the User's main Filter for visibility or simple logic
}

model Interest {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  
  senderId    String
  sender      User   @relation("SentInterests", fields: [senderId], references: [id])
  
  receiverId  String
  receiver    User   @relation("ReceivedInterests", fields: [receiverId], references: [id])
  
  status      String @default("PENDING") // PENDING, APPROVED, REJECTED
  allowMessage Boolean @default(false)    // If true, sender can message directly to PRIMARY inbox
  inviteMessage String?                   // Custom message from sender (e.g., "Piši mi!")
  
  @@unique([senderId, receiverId]) // One interest per pair
}

model Room {
  id        String   @id @default(uuid())
  name      String   @unique
  description String?
  createdAt DateTime @default(now())
  
  messages  RoomMessage[]
}

model RoomMessage {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())
  
  roomId    String
  room      Room     @relation(fields: [roomId], references: [id])
  
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}
